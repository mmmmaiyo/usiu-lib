<!DOCTYPE html>

<!-- 
  Theme Name: Enlight
  Theme URL: https://probootstrap.com/enlight-free-education-responsive-bootstrap-website-template
  Author: ProBootstrap.com
  Author URL: https://probootstrap.com
  License: Released for free under the Creative Commons Attribution 3.0 license (probootstrap.com/license)
-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>USIU-Africa Library & Information Centre</title>

    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,700|Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="css/styles-merged.css">
    <link rel="stylesheet" href="css/style.min.css">
    <link rel="stylesheet" href="css/custom.css">

    <!--[if lt IE 9]>
      <script src="js/vendor/html5shiv.min.js"></script>
      <script src="js/vendor/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <!--SEARCH-->
    <div class="pbs-search" id="pbs-search">
        <a href="#" class="pbs-close js-pbs-close"><i class="icon-cross"></i></a>
        <!-- this is the search form we want it to have unique functionalities -->
        <form action="#">
            <input type="search" id="searchs" placeholder="Search a keyword and hit enter...">
        </form>
    </div>
    <!--LOGIN-->
    <div class="pbs-login" id="pbs-login">
        <div class="modal-content">
            <a href="#" class="pbs-closes js-pbs-closes"><i class="icon-cross"></i></a>
            <form id="login-form" action="#">
                <input type="text" id="username" placeholder="Username">
                <input type="password" id="password" placeholder="Password">
                <button class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <div class="pbs-page-wrapper">
        <!-- Fixed navbar -->

        <div class="pbs-header-top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-9 col-md-9 col-sm-9 pbs-top-quick-contact-info">
                        <span><i class="icon-location2"></i>USIU Road, Off Thika Road (Exit 7)</span>
                        <span><i class="icon-phone2"></i>+254 730 116690</span>
                        <span><i class="icon-mail"></i>askalibrarian@usiu.ac.ke</span>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 pbs-top-social">
                        <ul>
                            <li><a href="https://twitter.com/UsiuLibrary"><i class="icon-twitter"></i></a></li>
                            <li><a href="https://www.facebook.com/usiulibrary/"><i class="icon-facebook2"></i></a></li>
                            <li><a href="# " class="pbs-search-icon js-pbs-search "><i class="icon-search "></i></a></li>
                            <li><a href="#" class="pbs-login-icon js-pbs-login">Log In</a></li>
                            <li><a href="#" class="js-pbs-logout" id="js-pbs-logout">Log Out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <nav class="navbar navbar-default pbs-navbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="btn-more js-btn-more visible-xs">
                        <a href="#"><i class="icon-dots-three-vertical "></i></a>
                    </div>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
                    <a class="navbar-brand" href="index.html" title="USIU-A Library"><img src="/img/usiu_400.jpg" id="usiu_logo"></a>
                </div>

                <div id="navbar-collapse" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="index.html">Home</a></li>
                        <li class="dropdown">
                            <a href="#" data-toggle="dropdown" class="dropdown-toggle">Browse</a>
                            <ul class="dropdown-menu">
                                <li><a href="resources.html">eResources</a></li>
                                <li><a href="newspapers.html">eNewspapers</a></li>
                            </ul>
                        </li>
                        <li><a href="about-us.html">About Us</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <section class="pbs-section pbs-section-colored">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 text-left section-heading pbs-animate">
                        <h1 class="mb0">My Account</h1>
                    </div>
                </div>
            </div>
        </section>

        <section class="pbs-section pbs-section-sm">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row pbs-gutter0">
                            <div class="col-md-4" id="pbs-sidebar">
                                <div class="pbs-sidebar-inner pbs-overlap pbs-animate">
                                    <h3 id="userAccountName">User Account</h3>
                                    <ul class="pbs-side-menu">
                                        <li><a href="" id="userInfo">User Information</a></li>
                                        <li><a href="" id="userBooks">Books</a></li>
                                        <!--<li><a href="#" id="js-pbs-logout">Log Out</a></li>-->
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-7 col-md-push-1  pbs-animate info-container" id="pbs-content">
                                <h2>First Name</h2>
                                <h3 id="firstname"></h3>
                                <h2>Last Name</h2>
                                <h3 id="lastname"></h3>
                            </div>
                            <!-- This is where the borrowed books will be rendered -->
                            <div id="borrowed-book-container" class="row">
                                <!-- Books will be added here dynamically -->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="pbs-footer pbs-bg">
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <div class="pbs-footer-widget">
                            <h3>Opening Hours</h3>
                            <p>Mon – Fri: 8.15 a.m. – 9 p.m.<br>Saturday: 9.00 a.m. – 6 p.m.<br> Sunday: 11.00 a.m. – 5 p.m.<br>Public Holidays: CLOSED</p>
                            <h3>During Semester Breaks</h3>
                            <p>Mon – Fri: 8.15 a.m. – 5 p.m.<br>Saturday, Sunday, & Public Holidays: CLOSED</p>
                            <h3>Social</h3>
                            <ul class="pbs-footer-social">
                                <li><a href="https://twitter.com/UsiuLibrary"><i class="icon-twitter"></i></a></li>
                                <li><a href="https://www.facebook.com/usiulibrary/"><i class="icon-facebook"></i></a></li>
                                <li><a href="https://www.linkedin.com/school/united-states-international-university-africa/"><i class="icon-linkedin"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3 col-md-push-1">
                        <div class="pbs-footer-widget">
                            <h3>Links</h3>
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">About Us</a></li>
                                <li><a href="#">Events</a></li>
                                <li><a href="#">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="pbs-footer-widget">
                            <h3>Contact Info</h3>
                            <ul class="pbs-contact-info">
                                <li><i class="icon-location2"></i> <span>USIU-Africa Library & Information Center<br>P. O. Box 14634-00800 NAIROBI, Kenya</span></li>
                                <li><i class="icon-mail"></i><span>library@usiu.ac.ke<br>asklibrarian@usiu.ac.ke</span></li>
                                <li><i class="icon-phone2"></i><span>+254 730 116000</span></li>
                            </ul>
                        </div>
                    </div>

                </div>
                <!-- END row -->

            </div>

            <div class="pbs-copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8 text-left">
                            <p>&copy; 2023 <a href="https://github.com/mmmmaiyo">Nigel Maiyo</a>. All Rights Reserved. Designed &amp; Developed with <i class="icon icon-heart"></i> and help from <a href="https://probootstrap.com/">ProBootstrap.com</a></p>
                        </div>
                        <div class="col-md-4 pbs-back-to-top">
                            <p><a href="#" class="js-backtotop">Back to top <i class="icon-arrow-long-up"></i></a></p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </div>
    <!-- END wrapper -->


    <script src="js/scripts.min.js"></script>
    <script src="js/main.min.js"></script>
    <script src="js/custom.js"></script>
    <script>
        const info = document.getElementsByClassName('info-container')[0];
        const borrowed_books = document.getElementById('borrowed-book-container');
        const userInfo = document.getElementById('userInfo');
        const userBooks = document.getElementById('userBooks');

        info.style.display = 'none';
        borrowed_books.style.display = 'none';

        userInfo.addEventListener('click', function (e) {
            e.preventDefault();
            info.style.visibility = 'visible';
            info.style.display = 'initial'
            borrowed_books.style.display = 'none';
        });
        userBooks.addEventListener('click', function (e) {
            e.preventDefault();
            info.style.display = 'none';
            borrowed_books.style.visibility = 'visible';
            borrowed_books.style.display = 'initial'
        });
    </script>
    <script>
        const username = localStorage.getItem('username');
        document.querySelector('#userAccountName').textContent = username;

        // Create a new XMLHttpRequest object
        var profile_xhr = new XMLHttpRequest();

        // Configure the request
        profile_xhr.open('GET', 'http://localhost:8080/users/profile?username=' + username, true);

        // Set up a handler for when the request finishes
        profile_xhr.onload = function() {
            if (profile_xhr.status === 200) {
                // Parse the JSON response
                var userProfile = JSON.parse(profile_xhr.responseText);
                console.log(userProfile); // Log the user profile data
                // Use the user profile data as needed
                document.getElementById('firstname').textContent = userProfile.firstName;
                document.getElementById('lastname').textContent = userProfile.lastName;
            } else {
                console.error('Request failed:', profile_xhr.status);
            }
        };

        // Send the request
        profile_xhr.send();
        // Get the container element
        var container = document.getElementById('borrowed-book-container');

        fetch(`http://localhost:8080/BorrowedBooks/borrowed/${username}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(books => {
                books.forEach(book => {
                    var bookElement = document.createElement('div');
                    bookElement.className = 'col-md-6';

                    bookElement.innerHTML = `
                <div class="pbs-service-2 pbs-animates ">
                    <div class="text " style="width:auto">
                        <h3>${book.title}</h3>
                        <p>${book.author}</p>
                        <p>${book.description}</p>
                        <button class="btn btn-primary order-book-btn" data-username="${username}" data-bookid="${book._id}">Return Book</button>
                    </div>
                </div>
            `;
                    container.appendChild(bookElement);
                });
                document.querySelectorAll('.order-book-btn').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const username = event.target.getAttribute('data-username');
                        const bookId = event.target.getAttribute('data-bookid');

                        // Make a POST request to the specified route
                        try {
                            const response = await fetch(`http://localhost:8080/BorrowedBooks/return/${username}/${bookId}`, {
                                method: 'POST',
                            });

                            if (response.ok) {
                                // Handle success (e.g., show a success message)
                                console.log('Book returned successfully');
                                alert('Book returned successfully');
                                // Refresh the page
                                window.location.reload();
                            } else {
                                // Handle errors (e.g., show an error message)
                                console.error('Failed to return book');
                            }
                        } catch (error) {
                            console.error('An error occurred:', error);
                        }
                    });
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
    

</body>

</html>